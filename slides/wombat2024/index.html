<!DOCTYPE html>
<html lang="en"><head>
<script src="script_files/libs/clipboard/clipboard.min.js"></script>
<script src="script_files/libs/quarto-html/tabby.min.js"></script>
<script src="script_files/libs/quarto-html/popper.min.js"></script>
<script src="script_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="script_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="script_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="script_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="script_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.45">

  <meta name="author" content="Elio Campitelli">
  <title>Read, manipulate and plot gridded data with metR</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="script_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="script_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #657b83; background-color: #fdf6e3; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #657b83; } /* Normal */
    code span.al { color: #d33682; font-weight: bold; } /* Alert */
    code span.an { color: #268bd2; } /* Annotation */
    code span.at { color: #268bd2; } /* Attribute */
    code span.bn { color: #2aa198; } /* BaseN */
    code span.bu { color: #cb4b16; } /* BuiltIn */
    code span.cf { color: #859900; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #2aa198; } /* Char */
    code span.cn { color: #2aa198; font-weight: bold; } /* Constant */
    code span.co { color: #93a1a1; font-style: italic; } /* Comment */
    code span.cv { color: #2aa198; } /* CommentVar */
    code span.do { color: #dc322f; } /* Documentation */
    code span.dt { color: #b58900; font-weight: bold; } /* DataType */
    code span.dv { color: #2aa198; } /* DecVal */
    code span.er { color: #dc322f; text-decoration: underline; } /* Error */
    code span.ex { color: #268bd2; font-weight: bold; } /* Extension */
    code span.fl { color: #2aa198; } /* Float */
    code span.fu { color: #268bd2; } /* Function */
    code span.im { color: #2aa198; } /* Import */
    code span.in { color: #b58900; } /* Information */
    code span.kw { color: #859900; font-weight: bold; } /* Keyword */
    code span.op { color: #859900; } /* Operator */
    code span.ot { color: #859900; } /* Other */
    code span.pp { color: #cb4b16; } /* Preprocessor */
    code span.re { color: #268bd2; background-color: #eee8d5; } /* RegionMarker */
    code span.sc { color: #dc322f; } /* SpecialChar */
    code span.ss { color: #dc322f; } /* SpecialString */
    code span.st { color: #2aa198; } /* String */
    code span.va { color: #268bd2; } /* Variable */
    code span.vs { color: #2aa198; } /* VerbatimString */
    code span.wa { color: #cb4b16; } /* Warning */
  </style>
  <link rel="stylesheet" href="script_files/libs/revealjs/dist/theme/quarto.css">
  <link href="script_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="script_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="script_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="script_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="img/title_crop_blur.png" data-background-opacity="1" data-background-position="bottom" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Read, manipulate and plot gridded data with metR</h1>
  <p class="subtitle">Open the World with Open Source, WOMBAT 2024</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Elio Campitelli 
</div>
        <p class="quarto-title-affiliation">
            Monash University
          </p>
    </div>
</div>

</section>
<section>
<section id="reading-data" class="title-slide slide level1 center" data-background-image="img/mosaico.png" data-background-position="right" data-background-size="contain" data-background-opacity="1">
<h1>Reading data</h1>

</section>
<section class="slide level2">

<p>We are going to use ERA5 data, which is weather data on a regular grid. The data is in a NetCDF file.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a>era5_sst <span class="ot">&lt;-</span> <span class="st">"data/era_sst.nc"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" data-code-line-numbers="|2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>era5_sst <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href=""></a>  metR<span class="sc">::</span><span class="fu">GlanceNetCDF</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Variables ----- 
sst:
    Sea surface temperature in K
    Dimensions: lon by lat by time


----- Dimensions ----- 
  time: 528 values from 1980-01-01 to 2023-12-01 
  lon: 144 values from 0 to 357.5 degrees_east
  lat: 72 values from -88.75 to 88.75 degrees_north</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>We can read one variable with <code>ReadNetCDF()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" data-code-line-numbers="|2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>sst <span class="ot">&lt;-</span> era5_sst <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href=""></a>  metR<span class="sc">::</span><span class="fu">ReadNetCDF</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, the result is a data.table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="fu">na.omit</span>(sst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               time    lat   lon      sst
             &lt;POSc&gt;  &lt;num&gt; &lt;num&gt;    &lt;num&gt;
      1: 1980-01-01 -76.25 165.0 271.6997
      2: 1980-01-01 -76.25 167.5 272.1290
      3: 1980-01-01 -76.25 170.0 272.8590
      4: 1980-01-01 -76.25 172.5 272.6795
      5: 1980-01-01 -76.25 175.0 272.5256
     ---                                 
3409292: 2023-12-01  88.75 347.5 271.4602
3409293: 2023-12-01  88.75 350.0 271.4602
3409294: 2023-12-01  88.75 352.5 271.4602
3409295: 2023-12-01  88.75 355.0 271.4602
3409296: 2023-12-01  88.75 357.5 271.4602</code></pre>
</div>
</div>
</section></section>
<section>
<section id="plotting-data" class="title-slide slide level1 center" data-background-image="img/papel_mask.png" data-background-position="right" data-background-size="contain" data-background-opacity="1">
<h1>Plotting data</h1>

</section>
<section class="slide level2">

<p>We can take a look at one slice of the data by subsetting the first time and plotting with <code>geom_contour_fill()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7" data-code-line-numbers="|2|4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb7-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb7-4"><a href=""></a>  metR<span class="sc">::</span><span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/look-sst-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<!-- ```{r monthly-mean-sst} -->
<!-- #| code-line-numbers: "|2" -->
<!-- sst |>  -->
<!--   _[, .(mean = mean(sst)), by = .(lon, lat, month(time))] |>  -->
<!--   ggplot(aes(lon, lat)) + -->
<!--   geom_contour_fill(aes(z = mean)) + -->
<!--   facet_wrap(~ month) -->
<!-- ``` -->
<!-- --- -->
<!-- We can also add a column with the departures from that climatological cycle.  -->
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>sst <span class="ot">&lt;-</span> sst[, sst_a <span class="sc">:</span><span class="er">=</span> sst <span class="sc">-</span> <span class="fu">mean</span>(sst, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-2"><a href=""></a>           by <span class="ot">=</span> .(lon, lat, <span class="fu">month</span>(time))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" data-code-line-numbers="|2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb9-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/jan1998-sst-viridis-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">


<img data-src="script_files/figure-revealjs/jan1998-sst-viridis2-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><p>Where’s the zero?</p>
</section>
<section class="slide level2">

<!-- Anomalies are centered at zero, so when plotting them, it's a good idea to use a divergent scale (`scale_fill_divergent()`) and center contour breaks at zero, also excluding the zero break to highligh positive and negative areas.  -->
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" data-code-line-numbers="|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb10-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb10-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a)) <span class="sc">+</span></span>
<span id="cb10-5"><a href=""></a>  metR<span class="sc">::</span><span class="fu">scale_fill_divergent</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/jan1998-sst-div-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<!-- One issue with this plot is that the breaks in the colour legend are independent of the contour breaks, so it's not easy to actually know the value that each colour represents.  -->
<!-- We can use the `level` computed variable, which is a discrete variable  -->
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" data-code-line-numbers="|5|6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb11-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb11-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a, </span>
<span id="cb11-5"><a href=""></a>                        <span class="at">fill =</span> <span class="fu">after_stat</span>(level))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell fragment" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="script_files/figure-revealjs/jan1998-sst-discrete-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12" data-code-line-numbers="|6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb12-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb12-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a, </span>
<span id="cb12-5"><a href=""></a>                        <span class="at">fill =</span> <span class="fu">after_stat</span>(level))) <span class="sc">+</span></span>
<span id="cb12-6"><a href=""></a>  metR<span class="sc">::</span><span class="fu">scale_fill_divergent_discretised</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<!-- 1. Map fill to level; which is a discrete (factor) variable computed by `geom_contour_fill()`. -->
<!-- 2. Use discretised scale, which understands the factors' format to create a 'continuous' scale with the correct breaks.  -->
<img data-src="script_files/figure-revealjs/jan1998-sst-discretised-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" data-code-line-numbers="|5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb13-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb13-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)),</span>
<span id="cb13-5"><a href=""></a>                    <span class="at">breaks =</span> metR<span class="sc">::</span><span class="fu">AnchorBreaks</span>(<span class="at">anchor =</span> <span class="dv">0</span>, <span class="at">exclude =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb13-6"><a href=""></a>  <span class="fu">scale_fill_divergent_discretised</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/jan1998-sst-anchor-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><aside class="notes">
<p>Finally, one of my favourite tricks to give contours a bit of flair is to use illuminated contours.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="|6,7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>sst <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href=""></a>  _[time <span class="sc">==</span> <span class="fu">as.POSIXct</span>(<span class="st">"1998-01-01"</span>)] <span class="sc">|&gt;</span>  </span>
<span id="cb14-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb14-4"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)),</span>
<span id="cb14-5"><a href=""></a>                    <span class="at">breaks =</span> <span class="fu">AnchorBreaks</span>(<span class="at">anchor =</span> <span class="dv">0</span>, <span class="at">exclude =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb14-6"><a href=""></a>  metR<span class="sc">::</span><span class="fu">geom_contour_tanaka</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a),</span>
<span id="cb14-7"><a href=""></a>                            <span class="at">breaks =</span> <span class="fu">AnchorBreaks</span>(<span class="at">anchor =</span> <span class="dv">0</span>, <span class="at">exclude =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb14-8"><a href=""></a>  <span class="fu">scale_fill_divergent_discretised</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/jan1998-sst-tanaka-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section></section>
<section>
<section id="transforming-data" class="title-slide slide level1 center" data-background-image="img/pp_blur.png" data-background-position="right" data-background-size="contain" data-background-opacity="1">
<h1>Transforming data</h1>

</section>
<section class="slide level2">


<img data-src="script_files/figure-revealjs/enso-intro-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><aside class="notes">
<p>I picked 1998 because it was a special year with a monster El Niño. This is a very important mode of variability that we might want to study. One way of analysing it is using Principal Component Analysis, also known as EOF in the climate sciences.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<p>We can compute the EOFs of SST with the <code>EOF()</code></p>

<img data-src="script_files/figure-revealjs/ensoregion-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="|2|3|4|5|6|7|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a>sst_eofs <span class="ot">&lt;-</span> sst <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href=""></a>  _[lon <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">280</span>) <span class="sc">&amp;</span> lat <span class="sc">%between%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)] <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href=""></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href=""></a>  _[, sst_a <span class="sc">:</span><span class="er">=</span> sst_a<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">cos</span>(lat<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span>))] <span class="sc">|&gt;</span>  </span>
<span id="cb15-5"><a href=""></a>  metR<span class="sc">::</span><span class="fu">EOF</span>(sst_a <span class="sc">~</span> time <span class="sc">|</span> lon <span class="sc">+</span> lat, </span>
<span id="cb15-6"><a href=""></a>            <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb15-7"><a href=""></a>            <span class="at">rotate =</span> stats<span class="sc">::</span>varimax,</span>
<span id="cb15-8"><a href=""></a>            <span class="at">data =</span> _) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<div class="columns">
<div class="column" style="width:33%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a>sst_eofs<span class="sc">$</span>sdev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:33%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a>sst_eofs<span class="sc">$</span>left</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            time    PC        sst_a
          &lt;POSc&gt; &lt;ord&gt;        &lt;num&gt;
   1: 1980-01-01   PC1 -0.019252316
   2: 1980-02-01   PC1 -0.007689172
   3: 1980-03-01   PC1 -0.005731776
   4: 1980-04-01   PC1 -0.008607639
   5: 1980-05-01   PC1 -0.001143759
  ---                              
5276: 2023-08-01  PC10  0.035440127
5277: 2023-09-01  PC10  0.065182685
5278: 2023-10-01  PC10  0.036879878
5279: 2023-11-01  PC10 -0.008752136
5280: 2023-12-01  PC10 -0.031711463</code></pre>
</div>
</div>
</div><div class="column" style="width:33%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a>sst_eofs<span class="sc">$</span>right</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        lon   lat    PC      sst_a
      &lt;num&gt; &lt;num&gt; &lt;ord&gt;      &lt;num&gt;
   1: 150.0 -8.75   PC1 0.02017407
   2: 152.5 -8.75   PC1 0.01678406
   3: 155.0 -8.75   PC1 0.01752412
   4: 157.5 -8.75   PC1 0.01821094
   5: 160.0 -8.75   PC1 0.01008606
  ---                             
4146: 265.0  8.75  PC10 0.03777417
4147: 267.5  8.75  PC10 0.09978071
4148: 270.0  8.75  PC10 0.16587637
4149: 272.5  8.75  PC10 0.09926842
4150: 275.0  8.75  PC10 0.02879130</code></pre>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Quick look with <code>screeplot()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="fu">screeplot</span>(sst_eofs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/screeplot-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="|2|3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a>sst_eofs <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href=""></a>  <span class="fu">cut</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href=""></a>  _<span class="sc">$</span>right <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span> </span>
<span id="cb22-5"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> sst_a), </span>
<span id="cb22-6"><a href=""></a>                    <span class="at">breaks =</span> <span class="fu">AnchorBreaks</span>(<span class="dv">0</span>, <span class="at">binwidth =</span> <span class="fl">0.02</span>, <span class="at">exclude =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-7"><a href=""></a>  <span class="fu">scale_fill_divergent</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> PC, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href=""></a>  tagger<span class="sc">::</span><span class="fu">tag_facets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<!-- --- -->
<!-- Add continents as reference.  -->
<!-- Quick trick: draw zero contour of topography.  -->
<!-- ```{r eofs-topo}  -->
<!-- #| code-line-numbers: "|4" -->
<!-- cut(sst_eofs, 1:2)$right |>  -->
<!--   ggplot(aes(lon, lat)) +  -->
<!--   geom_contour_fill(aes(z = sst_a), breaks = AnchorBreaks(0, exclude = 0)) + -->
<!--   metR::geom_contour2(data = topo, aes(z = topo), breaks = 0) + -->
<!--   scale_fill_divergent() + -->
<!--   facet_wrap(~ PC) -->
<!-- ``` -->
<img data-src="script_files/figure-revealjs/spatial-eofs-hl-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="fu">cut</span>(sst_eofs, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)<span class="sc">$</span>left <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time, sst_a)) <span class="sc">+</span></span>
<span id="cb23-3"><a href=""></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> PC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/unnamed-chunk-2-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section></section>
<section>
<section id="analyse-data" class="title-slide slide level1 center" data-background-image="img/bauhaus.png" data-background-position="right" data-background-size="contain" data-background-opacity="1">
<h1>Analyse data</h1>

</section>
<section id="how-does-enso-affect-the-atmosphere" class="slide level2">
<h2>How does ENSO affect the atmosphere?</h2>
<p>Is there a relationship between ENSO and atmospheric circulation and rain around South America?</p>
</section>
<section class="slide level2">

<p>So first read the variables</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a>era5_variables <span class="ot">&lt;-</span> <span class="st">"data/era5_variables.nc"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a>era5_variables <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href=""></a>  <span class="fu">GlanceNetCDF</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Variables ----- 
z:
    Geopotential in m**2 s**-2
    Dimensions: lon by lat by level by time
tp:
    Total precipitation in m
    Dimensions: lon by lat by time


----- Dimensions ----- 
  time: 528 values from 1980-01-01 to 2023-12-01 
  lon: 360 values from 0 to 359 degrees_east
  lat: 180 values from -89.5 to 89.5 degrees_north
  level: 3 values from 200 to 850 millibars</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" data-code-line-numbers="|2|3,4,5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a>era5_vars <span class="ot">&lt;-</span> era5_variables <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href=""></a>  <span class="fu">ReadNetCDF</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="at">pp =</span> <span class="st">"tp"</span>, <span class="st">"z"</span>), </span>
<span id="cb27-3"><a href=""></a>             <span class="at">subset =</span> <span class="fu">list</span>(<span class="at">lon =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">360</span>), </span>
<span id="cb27-4"><a href=""></a>                           <span class="at">lat =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb27-5"><a href=""></a>                           <span class="at">level =</span> <span class="dv">500</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section class="slide level2">

<p>Reshape into long and compute anomalies.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a>era5_vars <span class="ot">&lt;-</span> era5_vars <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href=""></a>  <span class="fu">dt_pivot_longer</span>(<span class="at">cols =</span> z<span class="sc">:</span>pp) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href=""></a>  _[, value_a <span class="sc">:</span><span class="er">=</span> value <span class="sc">-</span> <span class="fu">mean</span>(value), by <span class="ot">=</span> .(lon, lat, <span class="fu">month</span>(time), name)]</span>
<span id="cb28-4"><a href=""></a><span class="fu">head</span>(era5_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         time level   lat   lon   name    value  value_a
       &lt;POSc&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt;    &lt;num&gt;    &lt;num&gt;
1: 1980-01-01   500 -89.5   180      z 50311.02 61.91504
2: 1980-01-01   500 -89.5   181      z 50311.02 62.04288
3: 1980-01-01   500 -89.5   182      z 50311.02 62.17072
4: 1980-01-01   500 -89.5   183      z 50311.02 62.28738
5: 1980-01-01   500 -89.5   184      z 50311.02 62.39284
6: 1980-01-01   500 -89.5   185      z 50311.02 62.49822</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Join data and EOFs</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a>for_regression <span class="ot">&lt;-</span> <span class="fu">cut</span>(sst_eofs, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)<span class="sc">$</span>left <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href=""></a>  <span class="fu">dt_pivot_wider</span>(<span class="at">names_from =</span> PC, <span class="at">values_from =</span> sst_a) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href=""></a>  <span class="fu">merge</span>(era5_vars)</span>
<span id="cb30-4"><a href=""></a></span>
<span id="cb30-5"><a href=""></a>for_regression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;time&gt;
                time         PC1         PC2 level   lat   lon   name
              &lt;POSc&gt;       &lt;num&gt;       &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt;
       1: 1980-01-01  0.02021858 -0.03311131   500 -89.5   180      z
       2: 1980-01-01  0.02021858 -0.03311131   500 -89.5   181      z
       3: 1980-01-01  0.02021858 -0.03311131   500 -89.5   182      z
       4: 1980-01-01  0.02021858 -0.03311131   500 -89.5   183      z
       5: 1980-01-01  0.02021858 -0.03311131   500 -89.5   184      z
      ---                                                            
15206396: 2023-12-01 -0.08664352 -0.06273200   500 -10.5   355     pp
15206397: 2023-12-01 -0.08664352 -0.06273200   500 -10.5   356     pp
15206398: 2023-12-01 -0.08664352 -0.06273200   500 -10.5   357     pp
15206399: 2023-12-01 -0.08664352 -0.06273200   500 -10.5   358     pp
15206400: 2023-12-01 -0.08664352 -0.06273200   500 -10.5   359     pp
                 value      value_a
                 &lt;num&gt;        &lt;num&gt;
       1: 5.031102e+04 6.191504e+01
       2: 5.031102e+04 6.204288e+01
       3: 5.031102e+04 6.217072e+01
       4: 5.031102e+04 6.228738e+01
       5: 5.031102e+04 6.239284e+01
      ---                          
15206396: 4.284156e-04 1.182178e-04
15206397: 4.273526e-04 1.400348e-04
15206398: 3.901453e-04 1.278820e-04
15206399: 3.391181e-04 9.659404e-05
15206400: 3.008477e-04 6.760133e-05</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Compute linear regression</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32" data-code-line-numbers="|2|1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a>regression <span class="ot">&lt;-</span> for_regression[, metR<span class="sc">::</span><span class="fu">FitLm</span>(value_a, PC1, PC2),</span>
<span id="cb32-2"><a href=""></a>                             by <span class="ot">=</span> .(lon, lat, <span class="at">season =</span> metR<span class="sc">::</span><span class="fu">season</span>(time), name)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href=""></a>regression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          lon   lat season   name        term      estimate
        &lt;num&gt; &lt;num&gt; &lt;fctr&gt; &lt;char&gt;      &lt;char&gt;         &lt;num&gt;
     1:   180 -89.5    DJF      z (Intercept) -9.751149e-13
     2:   180 -89.5    DJF      z         PC1 -3.185336e+02
     3:   180 -89.5    DJF      z         PC2 -2.215233e+03
     4:   181 -89.5    DJF      z (Intercept) -3.168992e-12
     5:   181 -89.5    DJF      z         PC1 -3.195499e+02
    ---                                                    
345596:   358 -10.5    SON     pp         PC1  1.095372e-04
345597:   358 -10.5    SON     pp         PC2  8.427022e-05
345598:   359 -10.5    SON     pp (Intercept)  4.667631e-21
345599:   359 -10.5    SON     pp         PC1  6.628679e-05
345600:   359 -10.5    SON     pp         PC2  2.318171e-05</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2">

<aside class="notes">
<p>For expediency, let’s look only at Spring (“September-October-November”):</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a>regression_spring <span class="ot">&lt;-</span> regression <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href=""></a>  _[season <span class="sc">==</span> <span class="st">"SON"</span>] <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href=""></a>  _[term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a>regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb36-3"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> estimate)) <span class="sc">+</span></span>
<span id="cb36-4"><a href=""></a>  geom_topo <span class="sc">+</span></span>
<span id="cb36-5"><a href=""></a>  <span class="fu">scale_fill_divergent</span>() <span class="sc">+</span></span>
<span id="cb36-6"><a href=""></a>  <span class="fu">facet_grid</span>(term <span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/regression_spring-base-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<aside class="notes">
<p>The problem here is that precipitation and geopotential height are in completely differnet units so we cannot represent both in the same colour scale. We could use different colour scales using ggnewscale, but I’m going to plot one variable with filled contours and the other with regular lines. To know the value of each contour, I’m going to use the <code>label</code> aesthetic to print the level</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a>regression_spring <span class="ot">&lt;-</span> regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href=""></a>  <span class="fu">dt_pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38" data-code-line-numbers="|4,5,6|6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a>regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb38-3"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> pp)) <span class="sc">+</span></span>
<span id="cb38-4"><a href=""></a>  metR<span class="sc">::</span><span class="fu">geom_contour2</span>(<span class="fu">aes</span>(<span class="at">z =</span> z<span class="sc">/</span><span class="fl">9.8</span>, </span>
<span id="cb38-5"><a href=""></a>                          <span class="at">linetype =</span> <span class="fu">after_stat</span>(<span class="fu">factor</span>(<span class="fu">sign</span>(<span class="sc">-</span>level))), </span>
<span id="cb38-6"><a href=""></a>                          <span class="at">label =</span> <span class="fu">after_stat</span>(level))) <span class="sc">+</span></span>
<span id="cb38-7"><a href=""></a>  geom_topo <span class="sc">+</span></span>
<span id="cb38-8"><a href=""></a>  <span class="fu">scale_fill_divergent</span>() <span class="sc">+</span></span>
<span id="cb38-9"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/regression_spring-contours-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<aside class="notes">
<p>This way we can see the interaction between the circulation and precipitation effect of ENSO. An alternative way to look at geopotential height is to use the Geostrophic Wind approximation. In the mid latitudes, the wind goes righly paralel to geopotential contours and clockwise around negative anomalies. We can compute this circulation with <code>GeostrophicWind()</code>. Because we are plotting in latlon coordinates, we then need to transform the wind vectors from physical uints to lonlat units with <code>dlon</code> and <code>dlat</code>. Finally, we plot the vectors with <code>geom_vector()</code>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39" data-code-line-numbers="|2|3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a>regression_spring <span class="ot">&lt;-</span> regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href=""></a>  _[, <span class="fu">c</span>(<span class="st">"u"</span>, <span class="st">"v"</span>) <span class="sc">:</span><span class="er">=</span> metR<span class="sc">::</span><span class="fu">GeostrophicWind</span>(z, lon, lat), by <span class="ot">=</span> .(term)] <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href=""></a>  _[, <span class="fu">c</span>(<span class="st">"dlon"</span>, <span class="st">"dlat"</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">list</span>(metR<span class="sc">::</span><span class="fu">dlon</span>(u, lat), metR<span class="sc">::</span><span class="fu">dlat</span>(v))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40" data-code-line-numbers="|4,5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a>regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb40-3"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> pp)) <span class="sc">+</span></span>
<span id="cb40-4"><a href=""></a>  metR<span class="sc">::</span><span class="fu">geom_vector</span>(<span class="fu">aes</span>(<span class="at">dx =</span> dlon, <span class="at">dy =</span> dlat), <span class="at">skip =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href=""></a>  metR<span class="sc">::</span><span class="fu">scale_mag</span>() <span class="sc">+</span></span>
<span id="cb40-6"><a href=""></a>  geom_topo <span class="sc">+</span></span>
<span id="cb40-7"><a href=""></a>  <span class="fu">scale_fill_divergent</span>() <span class="sc">+</span></span>
<span id="cb40-8"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/regression_spring-vectors-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<aside class="notes">
<p>An alternative that I like is to use <code>geom_streamline()</code>. This draws lines that follow the flow of the vector field:</p>
<p>And to add more flair (and clarity, IMHO), we can remove the arrows and signal the direction of the streamlines by mapping the linewidth to the <code>step</code> computed variable, which goes from 0 to the number of steps in the line (in this case to the forth power to make the effect more dramatic).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- ```{r regression_spring-streamlines} -->
<!-- #| code-line-numbers: "|4,5" -->
<!-- regression_spring |>  -->
<!--   ggplot(aes(lon, lat)) + -->
<!--   geom_contour_fill(aes(z = pp)) + -->
<!--   metR::geom_streamline(aes(dx = dlon , dy = dlat), -->
<!--                         skip = 5, L = 30) + -->
<!--   geom_topo + -->
<!--   scale_fill_divergent() + -->
<!--   facet_wrap(~term, ncol = 1) -->
<!-- ``` -->
<!-- --- -->
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41" data-code-line-numbers="|4,5,6,7,8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href=""></a>regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb41-3"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> pp)) <span class="sc">+</span></span>
<span id="cb41-4"><a href=""></a>  <span class="fu">geom_streamline</span>(<span class="fu">aes</span>(<span class="at">dx =</span> dlon , <span class="at">dy =</span> dlat, </span>
<span id="cb41-5"><a href=""></a>                      <span class="at">linewidth =</span> <span class="fu">after_stat</span>(step<span class="sc">^</span><span class="dv">4</span>)),</span>
<span id="cb41-6"><a href=""></a>                  <span class="at">arrow =</span> <span class="cn">NULL</span>,  <span class="at">lineend =</span> <span class="st">"round"</span>,</span>
<span id="cb41-7"><a href=""></a>                  <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">L =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href=""></a>  <span class="fu">scale_linewidth</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.6</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href=""></a>  geom_topo <span class="sc">+</span></span>
<span id="cb41-10"><a href=""></a>  <span class="fu">scale_fill_divergent</span>() <span class="sc">+</span></span>
<span id="cb41-11"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/regression_spring-streamdrops-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

<aside class="notes">
<p>So now we can start with the details. The x and y axis can be printed nicer with <code>scale_x_longitude()</code> and <code>scale_y_latitude()</code>, which are thin wrappers around continuous scale with common defaults appropriate for these dimensions.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42" data-code-line-numbers="|14,15|11,12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a>regression_spring <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(lon, lat)) <span class="sc">+</span></span>
<span id="cb42-3"><a href=""></a>  <span class="fu">geom_contour_fill</span>(<span class="fu">aes</span>(<span class="at">z =</span> pp, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)), </span>
<span id="cb42-4"><a href=""></a>                    <span class="at">breaks =</span> <span class="fu">AnchorBreaks</span>(<span class="dv">0</span>, <span class="at">exclude =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb42-5"><a href=""></a>  <span class="fu">geom_streamline</span>(<span class="fu">aes</span>(<span class="at">dx =</span> dlon , <span class="at">dy =</span> dlat, </span>
<span id="cb42-6"><a href=""></a>                      <span class="at">linewidth =</span> <span class="fu">after_stat</span>(step<span class="sc">^</span><span class="dv">4</span>)),</span>
<span id="cb42-7"><a href=""></a>                  <span class="at">arrow =</span> <span class="cn">NULL</span>,  <span class="at">lineend =</span> <span class="st">"round"</span>,</span>
<span id="cb42-8"><a href=""></a>                  <span class="at">skip =</span> <span class="dv">5</span>, <span class="at">L =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb42-9"><a href=""></a>  <span class="fu">scale_linewidth</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.6</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb42-10"><a href=""></a>  geom_topo <span class="sc">+</span></span>
<span id="cb42-11"><a href=""></a>  <span class="fu">scale_fill_divergent_discretised</span>(<span class="at">low =</span> scales<span class="sc">::</span><span class="fu">muted</span>(<span class="st">"orange"</span>), </span>
<span id="cb42-12"><a href=""></a>                                   <span class="at">high =</span> scales<span class="sc">::</span><span class="fu">muted</span>(<span class="st">"green"</span>)) <span class="sc">+</span></span>
<span id="cb42-13"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>term, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href=""></a>  metR<span class="sc">::</span><span class="fu">scale_x_longitude</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href=""></a>  metR<span class="sc">::</span><span class="fu">scale_y_latitude</span>()  <span class="sc">+</span></span>
<span id="cb42-16"><a href=""></a>  <span class="fu">coord_quickmap</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="script_files/figure-revealjs/regression_spring-flair-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">


<img data-src="script_files/figure-revealjs/unnamed-chunk-3-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section class="slide level2">

</section></section>
<section id="thanks" class="title-slide slide level1 center" data-background-image="img/logo.png" data-background-position="85% 50%" data-background-size="500px" data-background-opacity="1">
<h1>Thanks!</h1>
<p><a href="https://eliocamp.github.io/metR/">eliocamp.github.io/metR/</a></p>
<p><a href="https://eliocamp.github.io/">eliocamp.github.io/</a></p>
<p><a href="eliocamp.github.io/slides/wombat2024">eliocamp.github.io/slides/wombat2024</a></p>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="script_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="script_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="script_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="script_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="script_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="script_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="script_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="script_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="script_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="script_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1500,

        height: 768,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>